<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#030303">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="android-mobile-web-app-capable" content="yes">
    <link rel="icon" type="image/png" href="https://fv5-5.files.fm/thumb_show.php?i=fmpaauyhdk&view&v=1">
    <link rel="apple-touch-icon" href="https://fv5-5.files.fm/thumb_show.php?i=fmpaauyhdk&view&v=1">
    <title>Meta Officiel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://player.vimeo.com/api/player.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg-color: #030303; 
            --white: #0a0a0a; 
            --surface: #111111;
            --border: #222222; 
            --text-main: #ffffff; 
            --text-sec: #888888;
            --accent: #D4AF37;
            --accent-text: #000000;
            --nav-bg: transparent; /* Navigation transparente */
            --card-shadow: 0 10px 30px rgba(0,0,0,0.5);
            --vh: 1vh;
            --ai-gradient: linear-gradient(135deg, #D4AF37, #FFF, #007AFF);
        }

        body[data-accent="gold"] { --accent: #D4AF37; --accent-text: #000000; }
        body[data-accent="blue"] { --accent: #007AFF; --accent-text: #ffffff; }
        body[data-accent="white"] { --accent: #FFFFFF; --accent-text: #000000; }
        
        body.light-mode { 
            --bg-color: #F5F5F7; 
            --white: #FFFFFF; 
            --surface: #FFFFFF;
            --border: #E0E0E0; 
            --text-main: #1D1D1F; 
            --text-sec: #86868B;
            --nav-bg: transparent;
            --card-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }
        body.light-mode[data-accent="black"] { --accent: #1D1D1F; --accent-text: #FFFFFF; }
        body.light-mode[data-accent="blue"] { --accent: #007AFF; --accent-text: #FFFFFF; }
        body.light-mode[data-accent="grey"] { --accent: #555555; --accent-text: #FFFFFF; }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        html, body { height: 100%; width: 100%; overflow: hidden; background-color: var(--bg-color); }
        body { 
            font-family: 'Montserrat', sans-serif;
            height: calc(var(--vh, 1vh) * 100);
            color: var(--text-main); 
            transition: all 0.4s ease; 
            -webkit-font-smoothing: antialiased;
            position: fixed; top: 0; left: 0;
        }
        
        :focus-visible { outline: 1px solid var(--accent); outline-offset: 2px; }
        .btn-press:active { transform: scale(0.96); opacity: 0.8; transition: 0.1s; }
        .glass { backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px); }

        /* LOADER & INSTALL BLOCKER */
        #loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999; display: flex; justify-content: center; align-items: center; flex-direction: column; transition: opacity 0.5s ease; padding: 30px; }
        .loader-icon { width: 80px; height: 80px; border-radius: 20px; background-image: url('https://fv5-5.files.fm/thumb_show.php?i=fmpaauyhdk&view&v=1'); background-size: cover; background-position: center; box-shadow: 0 0 20px rgba(212, 175, 50, 0.3); margin-bottom: 20px; }
        .loader-text { margin-top: 15px; font-family: 'Cormorant Garamond', serif; color: var(--accent); letter-spacing: 4px; font-size: 0.9rem; text-transform: uppercase; text-align: center; }
        
        /* Interface d'installation Android */
        .install-screen-android {
            display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; height: 100%; width: 100%; padding: 30px;
        }
        .install-logo { width: 120px; height: 120px; border-radius: 30px; margin-bottom: 30px; background-image: url('https://fv5-5.files.fm/thumb_show.php?i=fmpaauyhdk&view&v=1'); background-size: cover; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .install-title { font-family: 'Cormorant Garamond', serif; font-size: 2rem; color: #fff; margin-bottom: 10px; }
        .install-sub { color: #888; font-size: 0.9rem; margin-bottom: 40px; }
        .install-btn-main { background: var(--accent); color: var(--accent-text); padding: 18px 50px; border: none; border-radius: 30px; font-size: 1rem; font-weight: 700; cursor: pointer; box-shadow: 0 5px 20px rgba(212, 175, 50, 0.3); }
        .install-btn-main:active { transform: scale(0.95); }

        #app-container { width: 100%; height: 100%; display: flex; flex-direction: column; }

        /* --- ONBOARDING SCREEN --- */
        #onboarding-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 2000; display: none; flex-direction: column; justify-content: center; align-items: center; padding: 40px; text-align: center; overflow-y: auto; }
        .ob-title { font-family: 'Cormorant Garamond', serif; font-size: 2.5rem; color: #fff; margin-bottom: 10px; letter-spacing: 1px; }
        .ob-subtitle { font-size: 0.8rem; color: #666; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 50px; }
        
        .ob-step { display: none; width: 100%; max-width: 350px; animation: fadeIn 0.5s ease; }
        .ob-step.active { display: block; }
        
        .ob-options { display: flex; flex-direction: column; gap: 15px; width: 100%; }
        .ob-btn { padding: 20px; border: 1px solid #333; background: transparent; color: #fff; font-family: 'Montserrat', sans-serif; font-size: 0.9rem; letter-spacing: 2px; text-transform: uppercase; cursor: pointer; transition: all 0.3s; border-radius: 12px; }
        .ob-btn:hover { border-color: #fff; background: rgba(255,255,255,0.05); }
        .ob-btn.selected { border-color: var(--accent); background: rgba(255,255,255,0.05); color: var(--accent); }

        .color-options { display: flex; justify-content: center; gap: 25px; margin-top: 10px; }
        .color-circle { width: 65px; height: 65px; border-radius: 50%; border: 2px solid transparent; cursor: pointer; transition: transform 0.2s, border-color 0.3s; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; color: #fff; font-weight: 600; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .color-circle:active { transform: scale(0.9); }
        .color-circle.active { border-color: #fff; transform: scale(1.1); }
        
        .cc-gold { background: #D4AF37; color: #000; }
        .cc-blue { background: #007AFF; }
        .cc-white { background: #FFF; color: #000; }
        .cc-black { background: #1D1D1F; }
        .cc-grey { background: #555; }

        .ob-validate-btn { margin-top: 40px; padding: 15px 40px; background: #fff; color: #000; border: none; font-weight: 600; letter-spacing: 1px; cursor: pointer; transition: opacity 0.2s; border-radius: 12px; }
        .ob-validate-btn:disabled { opacity: 0.3; cursor: not-allowed; }

        /* --- LOGIN --- */
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-color); z-index: 1000; display: none; flex-direction: column; justify-content: center; align-items: center; padding: 40px; }
        .logo { font-family: 'Cormorant Garamond', serif; font-size: 3.5rem; font-weight: 300; margin-bottom: 60px; letter-spacing: 8px; color: var(--text-main); text-transform: uppercase; }
        input { width: 100%; max-width: 320px; padding: 20px; background: transparent; border: 1px solid var(--border); border-radius: 12px; margin-bottom: 20px; font-size: 14px; color: var(--text-main); font-family: 'Montserrat', sans-serif; font-weight: 300; letter-spacing: 1px; text-align: center; }
        input:focus { border-color: var(--accent); }
        input::placeholder { color: var(--text-sec); }
        .login-btn { width: 100%; max-width: 320px; background: transparent; color: var(--accent); padding: 20px; border: 1px solid var(--accent); border-radius: 12px; font-weight: 500; cursor: pointer; text-transform: uppercase; letter-spacing: 3px; font-family: 'Montserrat', sans-serif; font-size: 0.9rem; transition: 0.3s; }
        .login-btn:active { background: var(--accent); color: var(--accent-text); }
        #login-error { color: #ff4d4d; font-size: 0.8rem; margin-top: 15px; display: none; font-weight: 500; letter-spacing: 1px; text-transform: uppercase; }
        
        .remember-me { display: flex; align-items: center; gap: 10px; margin-top: 10px; color: var(--text-sec); font-size: 0.8rem; cursor: pointer; }
        .remember-me input { width: auto; margin: 0; transform: scale(0.8); accent-color: var(--accent); }

        /* --- MAIN APP --- */
        header { height: calc(75px + env(safe-area-inset-top)); padding-top: env(safe-area-inset-top); border-bottom: 1px solid var(--border); display: none; justify-content: center; align-items: center; position: relative; padding-left: 25px; padding-right: 25px; background: transparent; z-index: 100; flex-shrink: 0; }
        header span { font-family: 'Cormorant Garamond', serif; font-size: 1.7rem; font-weight: 600; letter-spacing: 1px; color: var(--text-main); text-transform: uppercase; text-align: center; }
        .header-left { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); padding-top: env(safe-area-inset-top); }
        .header-right { position: absolute; right: 20px; top: 50%; transform: translateY(-50%); display: flex; gap: 15px; padding-top: env(safe-area-inset-top); }

        .stories-container { display: flex; overflow-x: auto; padding: 30px 20px; gap: 30px; background: transparent; border-bottom: 1px solid var(--border); scrollbar-width: none; }
        .stories-container::-webkit-scrollbar { display: none; }
        .story-bubble { display: flex; flex-direction: column; align-items: center; min-width: 80px; cursor: pointer; border: none; background: none; }
        .story-img-wrapper { width: 72px; height: 72px; border-radius: 50%; background: var(--bg-color); border: 2px solid var(--accent); transition: 0.3s; overflow: hidden; display: flex; justify-content: center; align-items: center; padding: 2px; }
        .story-bubble:active .story-img-wrapper { transform: scale(0.95); border-color: var(--text-main); }
        .story-img-wrapper img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: none; }
        .story-img-wrapper i { font-size: 1.5rem; color: var(--text-sec); }
        .story-name { font-size: 0.7rem; color: var(--text-sec); width: 100%; text-align: center; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; font-weight: 500; letter-spacing: 1px; text-transform: uppercase; margin-top: 12px; }

        #main-app { display: none; flex-direction: column; height: 100%; width: 100%; }
        
        /* Content area ajust√© pour nav flottante */
        .content-area { flex: 1; position: relative; overflow: hidden; display: flex; flex-direction: column; padding-top: 25px; padding-bottom: 100px; }
        
        .section { height: 100%; width: 100%; position: absolute; top: 0; left: 0; visibility: hidden; opacity: 0; transform: scale(0.98); transition: visibility 0s linear 0.3s, opacity 0.3s ease, transform 0.3s ease; background: var(--bg-color); overflow-y: auto; }
        .section.active { visibility: visible; opacity: 1; transform: scale(1); transition: visibility 0s linear 0s, opacity 0.3s ease, transform 0.3s ease; z-index: 1; }
        
        .post { background: var(--surface); margin: 30px auto; max-width: 500px; border-radius: 12px; overflow: hidden; border: none; box-shadow: var(--card-shadow); position: relative; }
        .post-user { padding: 18px 20px; font-weight: 500; display: flex; align-items: center; gap: 15px; font-size: 0.85rem; cursor: pointer; color: var(--text-main); text-transform: uppercase; letter-spacing: 2px; }
        .post-user .mini-avatar { width: 35px; height: 35px; border-radius: 50%; background: #222; display: flex; align-items: center; justify-content: center; overflow: hidden; border: 1px solid var(--border); }
        
        .post-img-container { position: relative; cursor: pointer; user-select: none; }
        .post-img-container img { width: 100%; display: block; object-fit: cover; }
        
        .like-overlay { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0); pointer-events: none; color: #fff; text-shadow: 0 0 20px rgba(255,255,255,0.5); transition: transform 0.2s ease-out; z-index: 10; }
        .like-overlay.animate { transform: translate(-50%, -50%) scale(1.5); opacity: 0; transition: transform 0.3s ease-out, opacity 0.3s ease-out; }

        .post-actions { padding: 18px 20px; display: flex; justify-content: flex-end; border-top: 1px solid var(--border); }
        
        .action-btn { background: transparent; border: none; padding: 8px; cursor: pointer; color: var(--text-sec); font-size: 1.4rem; transition: color 0.3s, transform 0.2s; }
        .action-btn:hover { color: var(--text-main); transform: scale(1.1); }
        .action-btn:active { transform: scale(0.95); }
        .action-btn i { pointer-events: none; }
        .action-btn.saved { color: var(--accent); }

        #videos-section { background: #000; overflow-y: scroll; scroll-snap-type: y mandatory; scrollbar-width: none; }
        #videos-section::-webkit-scrollbar { display: none; } 
        .video-card { height: 100%; width: 100%; scroll-snap-align: start; scroll-snap-stop: always; position: relative; display: flex; align-items: center; justify-content: center; background: #000; }
        .video-card iframe { width: 100%; height: 100%; border: none; pointer-events: auto; }
        .video-info { position: absolute; bottom: 100px; left: 20px; color: white; z-index: 10; text-shadow: 0 2px 10px rgba(0,0,0,0.8); pointer-events: none; width: 80%; }
        .video-info h3 { font-family: 'Cormorant Garamond', serif; color: var(--accent); font-size: 1.4rem; }
        
        .seen-badge { position: absolute; top: 20px; right: 20px; background: rgba(0,0,0,0.6); color: #fff; padding: 5px 10px; border-radius: 20px; font-size: 0.6rem; text-transform: uppercase; letter-spacing: 1px; z-index: 5; opacity: 0.7; }

        .overlay-page { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-color); z-index: 600; overflow-y: auto; animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1); padding-top: calc(35px + env(safe-area-inset-top)); }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        @keyframes popIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }

        /* NAVIGATION FLOTTANTE (Sans fond) */
        nav {
            position: fixed; 
            bottom: 0; 
            left: 0; width: 100%; 
            height: auto; 
            padding: 0;
            padding-top: 10px;
            padding-bottom: calc(15px + env(safe-area-inset-bottom)); 
            display: flex; 
            justify-content: space-around; 
            align-items: center; 
            z-index: 999;
            background: transparent; /* Transparent */
            border-top: none; /* Pas de bordure */
        }
        
        .nav-indicator { position: absolute; top: 0; width: 30px; height: 3px; background: var(--accent); border-radius: 3px; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); opacity: 1; left: 0; box-shadow: 0 0 10px var(--accent); }
        
        nav button.nav-item { background: none; border: none; font-size: 1.4rem; color: var(--text-main); cursor: pointer; z-index: 2; width: 60px; height: 50px; display: flex; align-items: center; justify-content: center; transition: 0.3s; filter: drop-shadow(0 2px 2px rgba(0,0,0,0.5)); }
        nav button.nav-item.active { color: var(--accent); transform: translateY(-2px); }

        body.has-overlay nav { display: none; }

        /* PROFILE & SETTINGS */
        .profile-header { padding: 50px 20px; text-align: center; background: transparent; }
        .profile-pic-main { width: 110px; height: 110px; background: #111; border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; color: var(--accent); overflow: hidden; border: 1px solid var(--accent); }
        .profile-stats { display: flex; justify-content: center; gap: 50px; margin-bottom: 30px; color: var(--text-sec); }
        .stat-item { text-align: center; }
        .stat-num { display: block; font-size: 1.4rem; color: var(--text-main); font-weight: 600; margin-bottom: 5px; }
        .stat-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1px; }
        .profile-tabs { display: flex; background: transparent; border-bottom: 1px solid var(--border); }
        .p-tab { flex: 1; padding: 20px; text-align: center; color: var(--text-sec); cursor: pointer; font-size: 0.75rem; font-weight: 500; letter-spacing: 3px; border-bottom: 1px solid transparent; background: none; }
        .p-tab.active { color: var(--text-main); border-bottom: 1px solid var(--accent); }
        .content-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1px; padding: 1px; background: var(--border); }
        .grid-item { aspect-ratio: 1/1; background: var(--surface); overflow: hidden; position: relative; cursor: pointer; border: none; padding: 0; transition: opacity 0.3s; }
        .grid-item:active { opacity: 0.7; }
        .grid-item img { width: 100%; height: 100%; object-fit: cover; filter: grayscale(20%); }
        .header-btn { background: none; border: none; color: var(--text-sec); font-size: 1.2rem; cursor: pointer; padding: 8px; }
        .settings-group { padding: 25px; border-bottom: 1px solid var(--border); }
        .settings-title { font-family: 'Cormorant Garamond', serif; font-size: 1.3rem; margin-bottom: 20px; color: var(--text-main); }
        .settings-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .settings-label { font-size: 0.9rem; letter-spacing: 1px; color: var(--text-sec); text-transform: uppercase; }
        .picker-colors { display: flex; gap: 15px; }
        .picker-circle { width: 35px; height: 35px; border-radius: 50%; cursor: pointer; border: 2px solid transparent; transition: transform 0.2s; }
        .picker-circle.active { border-color: var(--text-main); transform: scale(1.1); }
        .empty-state { grid-column: 1 / -1; padding: 60px 20px; text-align: center; color: var(--text-sec); font-size: 0.9rem; letter-spacing: 1px; }

        /* AI BUTTON */
        #ai-btn-header { background: var(--ai-gradient); background-size: 200% 200%; animation: gradient-shift 3s ease infinite; width: 40px; height: 40px; border-radius: 12px; display: flex; align-items: center; justify-content: center; color: #fff; font-size: 1.1rem; cursor: pointer; box-shadow: 0 0 15px rgba(212, 175, 50, 0.3); border: none; transition: transform 0.2s; position: relative; }
        #ai-btn-header::after { content: ''; position: absolute; top: -3px; left: -3px; right: -3px; bottom: -3px; border-radius: 14px; border: 1px solid var(--accent); animation: pulse-ring 2s infinite; }
        #ai-btn-header:active { transform: scale(0.9); }
        #ai-btn-header.hidden { display: none; }

        @keyframes gradient-shift { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        @keyframes pulse-ring { 0% { transform: scale(1); opacity: 0.5; } 100% { transform: scale(1.2); opacity: 0; } }

        /* AI CHAT WINDOW & KEYBOARD */
        #ai-chat-window {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-color); border: none;
            display: none; flex-direction: column; z-index: 1100; 
            animation: slideUp 0.3s ease;
        }
        #ai-chat-window.active { display: flex; }
        
        .ai-top-bar { padding: 15px; background: transparent; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); min-height: 60px; margin-top: env(safe-area-inset-top); }
        .ai-top-title { font-size: 1rem; font-weight: 600; color: var(--accent); display: flex; align-items: center; gap: 8px; }
        .ai-top-close { background: none; border: none; color: var(--text-sec); cursor: pointer; font-size: 1.2rem; }

        .ai-msg-area { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; padding-bottom: 10px; }
        .ai-msg-bubble { max-width: 90%; padding: 12px 16px; border-radius: 20px; font-size: 0.95rem; line-height: 1.5; }
        .ai-msg-bubble.bot { background: var(--surface); align-self: flex-start; color: var(--text-main); border-bottom-left-radius: 4px; }
        .ai-msg-bubble.user { background: var(--accent); color: var(--accent-text); align-self: flex-end; border-bottom-right-radius: 4px; }
        
        /* APERCU ET CLAVIER */
        .ai-preview-area {
            padding: 10px 20px; min-height: 50px; font-size: 1rem; color: var(--text-main); 
            border-top: 1px solid var(--border); background: var(--surface); 
            display: flex; align-items: center;
        }
        .ai-preview-placeholder { color: var(--text-sec); }

        .ai-keyboard-area {
            background: var(--surface); padding: 5px; padding-bottom: calc(5px + env(safe-area-inset-bottom));
            display: flex; flex-direction: column; gap: 6px; border-top: 1px solid var(--border);
        }
        .ai-input-row { display: flex; justify-content: space-between; gap: 4px; }
        .ai-key {
            flex: 1; height: 44px; background: var(--bg-color); border: 1px solid var(--border); border-radius: 6px;
            color: var(--text-main); font-size: 1rem; cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: background 0.1s; text-transform: uppercase; font-weight: 500;
        }
        .ai-key:active { background: var(--border); }
        .ai-key.space { flex: 5; }
        .ai-key.accent { background: var(--accent); color: var(--accent-text); border-color: var(--accent); }
        .ai-key.action { background: transparent; border: none; }
    </style>
</head>
<body oncontextmenu="return false;" data-accent="gold">
<!-- LOADER -->
<div id="loader">
    <!-- Ecran Android -->
    <div id="android-install-ui" class="install-screen-android">
        <div class="install-logo"></div>
        <div class="install-title">Meta Officiel</div>
        <div class="install-sub">Installez l'application pour une exp√©rience optimale et s√©curis√©e.</div>
        <button id="install-btn-main" class="install-btn-main" onclick="triggerAndroidInstall()">
            <i class="fas fa-download" style="margin-right: 10px;"></i> Installer l'application
        </button>
    </div>
    
    <!-- Loader iOS / Default -->
    <div id="default-loader-ui">
        <div class="loader-icon"></div>
        <div class="loader-text" id="main-loader-text">Meta Officiel</div>
        <div id="install-block-content" style="display:none; flex-direction: column; align-items: center;">
            <div style="margin-top: 30px; font-size: 0.85rem; color: #fff; text-align: center; max-width: 280px; line-height: 1.6;">
                Pour une exp√©rience optimale, veuillez ajouter l'application √† votre √©cran d'accueil.<br><br>
                Safari : Partage <i class="fas fa-share" style="color: var(--accent);"></i> > "Sur l'√©cran d'accueil"
            </div>
        </div>
    </div>
</div>

<!-- HTML ONBOARDING, LOGIN, APP, AI CHAT identiques au pr√©c√©dent -->
<div id="onboarding-screen">
    <div class="ob-title">Meta Officiel</div>
    <div class="ob-subtitle">Personnalisation</div>
    <div id="ob-step-1" class="ob-step active">
        <div class="ob-subtitle" style="margin-bottom: 30px; font-size: 0.7rem;">Choisissez votre ambiance</div>
        <div class="ob-options">
            <button class="ob-btn" onclick="setObMode('dark')"><i class="fas fa-moon" style="margin-right: 10px;"></i> Mode Sombre</button>
            <button class="ob-btn" onclick="setObMode('light')"><i class="fas fa-sun" style="margin-right: 10px;"></i> Mode Clair</button>
        </div>
    </div>
    <div id="ob-step-2" class="ob-step">
        <div class="ob-subtitle" style="margin-bottom: 30px; font-size: 0.7rem;">S√©lectionnez l'accent</div>
        <div id="ob-color-container" class="color-options"></div>
        <button id="ob-validate-btn" class="ob-validate-btn" onclick="validateOnboarding()" disabled>Appliquer</button>
    </div>
</div>

<div id="login-screen">
    <div class="logo">Meta Officiel</div>
    <input type="text" id="username" placeholder="NOM D'UTILISATEUR" autocomplete="off">
    <input type="password" id="password" placeholder="MOT DE PASSE">
    <label class="remember-me"><input type="checkbox" id="remember-me"> Rester connect√©</label>
    <button class="login-btn btn-press" onclick="handleLogin()" style="margin-top: 20px;">Connexion</button>
    <div id="login-error">Acc√®s Refus√©</div>
</div>

<div id="app-container">
    <div id="main-app">
        <header class="glass" id="main-header">
            <div class="header-left"><div style="width:40px;"></div></div>
            <span>Meta Officiel</span>
            <div class="header-right">
                <button id="ai-btn-header" onclick="toggleAIChat(true)" style="display: none;"><i class="fas fa-brain"></i></button>
                <button id="global-cog" class="header-btn btn-press" style="display:none;" onclick="toggleSettings(true)"><i class="fas fa-cog"></i></button>
            </div>
        </header>

        <div class="content-area">
            <div id="feed-section" class="section active">
                <div id="stories-list" class="stories-container"></div>
                <div id="photo-list"></div>
            </div>
            <div id="search-section" class="section">
                <div style="padding:20px; position:sticky; top:0; z-index:10;"><input type="text" id="search-input" style="width:100%; margin-bottom:0; background:transparent; border-bottom:1px solid var(--border); border-top:none; border-left:none; border-right:none; text-align:left; font-size:1rem;" placeholder="Rechercher..." oninput="filtrerRecherche()"></div>
                <div id="search-results"></div>
            </div>
            <div id="videos-section" class="section"><div id="video-list" style="height: 100%;"></div></div>
            
            <div id="own-profile-section" class="section">
                <div class="profile-header">
                    <div id="my-profile-pic-container" class="profile-pic-main"><i class="fas fa-user"></i></div>
                    <h2 id="my-name-display" style="font-weight: 300; font-size: 2rem; font-family: 'Cormorant Garamond', serif;"></h2>
                    <p id="my-handle-display" style="font-size: 0.85rem; color: var(--text-sec); margin-bottom: 30px; letter-spacing: 2px; text-transform: uppercase;"></p>
                    <div class="profile-stats">
                        <div class="stat-item"><span id="stat-posts" class="stat-num">0</span><span class="stat-label">Publications</span></div>
                        <div class="stat-item"><span id="stat-saved" class="stat-num">0</span><span class="stat-label">Enregistr√©s</span></div>
                    </div>
                    <button onclick="handleLogout()" class="btn-press" style="color: var(--text-sec); border:1px solid var(--border); padding:14px 35px; border-radius:12px; background:transparent; font-size: 0.8rem; font-weight: 500; text-transform: uppercase; letter-spacing: 2px;">D√©connexion</button>
                </div>
                <div class="profile-tabs glass">
                    <button id="my-tab-pub" class="p-tab active" onclick="switchMyTab('info')">Publications</button>
                    <button id="my-tab-saved" class="p-tab" onclick="switchMyTab('saved')">Enregistr√©s</button>
                </div>
                <div id="my-posts-grid" class="content-grid"></div>
                <div id="my-saved-grid" class="content-grid" style="display:none;"></div>
            </div>

            <div id="external-profile-overlay" class="overlay-page">
                <div class="glass" style="padding: 15px; display: flex; align-items: center; border-bottom: 1px solid var(--border); position: sticky; top:0; z-index:10;">
                    <button class="header-btn btn-press" onclick="closeExternalProfile()"><i class="fas fa-arrow-left"></i></button>
                    <span id="ext-user-title" style="margin-left: 10px; font-weight: 600; font-family: 'Cormorant Garamond';"></span>
                </div>
                <div id="ext-header" style="padding: 40px; text-align: center;">
                    <div id="ext-profile-pic-container" style="width: 90px; height: 90px; background: #222; border-radius: 50%; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; overflow: hidden; border: 1px solid var(--accent);"><i class="fas fa-user"></i></div>
                    <h3 id="ext-display-name" style="font-size: 1.5rem; font-weight: 400; font-family: 'Cormorant Garamond', serif;"></h3>
                </div>
                <div class="profile-tabs"><div class="p-tab active">PUBLICATIONS</div></div>
                <div id="ext-posts-grid" class="content-grid"></div>
            </div>

            <div id="media-view-overlay" class="overlay-page">
                <div class="glass" style="padding: 15px; display: flex; align-items: center; border-bottom: 1px solid var(--border); position: sticky; top:0; z-index:10;">
                    <button class="header-btn btn-press" onclick="closeMediaView()"><i class="fas fa-arrow-left"></i></button>
                    <span style="margin-left: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 2px; font-size: 0.9rem;">D√©tails</span>
                </div>
                <div id="media-view-content"></div>
            </div>

            <div id="settings-overlay" class="overlay-page">
                <div class="glass" style="padding:15px; display: flex; align-items: center; border-bottom: 1px solid var(--border);">
                    <button class="header-btn btn-press" onclick="toggleSettings(false)"><i class="fas fa-arrow-left"></i></button>
                    <h2 style="margin-left: 10px; font-size: 1.1rem; font-family: 'Cormorant Garamond';">Param√®tres</h2>
                </div>
                <div class="settings-group">
                    <div class="settings-title">Apparence</div>
                    <div class="settings-row">
                        <span class="settings-label">Th√®me</span>
                        <div style="display:flex; gap:10px;">
                            <button class="ob-btn" style="padding:10px 18px; font-size:0.7rem; border-radius:10px;" onclick="setThemeMode('dark')" id="btn-mode-dark">Sombre</button>
                            <button class="ob-btn" style="padding:10px 18px; font-size:0.7rem; border-radius:10px;" onclick="setThemeMode('light')" id="btn-mode-light">Clair</button>
                        </div>
                    </div>
                    <div class="settings-row">
                        <span class="settings-label">Couleur</span>
                        <div id="settings-color-picker" class="picker-colors"></div>
                    </div>
                </div>
            </div>
        </div>

        <nav>
            <div class="nav-indicator" id="nav-indicator"></div>
            <button class="nav-item btn-press active" onclick="switchTab('feed', 0)"><i class="fas fa-house"></i></button>
            <button class="nav-item btn-press" onclick="switchTab('search', 1)"><i class="fas fa-magnifying-glass"></i></button>
            <button class="nav-item btn-press" onclick="switchTab('videos', 2)"><i class="fas fa-clapperboard"></i></button>
            <button class="nav-item btn-press" onclick="switchTab('own-profile', 3)"><i class="fas fa-circle-user"></i></button>
        </nav>
    </div>
</div>

<!-- AI CHAT WINDOW (CLAVIER INT√âGR√â) -->
<div id="ai-chat-window">
    <div class="ai-top-bar">
        <span class="ai-top-title"><i class="fas fa-wand-magic-sparkles"></i> Meta IA</span>
        <button class="ai-top-close" onclick="toggleAIChat(false)"><i class="fas fa-times"></i></button>
    </div>
    <div id="ai-msg-area" class="ai-msg-area"><div class="ai-msg-bubble bot">Bonjour ! Je suis votre assistant. Posez-moi une question.</div></div>
    
    <!-- APERCU DU TEXTE -->
    <div id="ai-preview" class="ai-preview-area"><span class="ai-preview-placeholder">√âcrivez votre message...</span></div>

    <!-- CLAVIER INT√âGR√â -->
    <div class="ai-keyboard-area">
        <div class="ai-input-row">
            <button class="ai-key" onclick="aiType('1')">1</button>
            <button class="ai-key" onclick="aiType('2')">2</button>
            <button class="ai-key" onclick="aiType('3')">3</button>
            <button class="ai-key" onclick="aiType('4')">4</button>
            <button class="ai-key" onclick="aiType('5')">5</button>
            <button class="ai-key" onclick="aiType('6')">6</button>
            <button class="ai-key" onclick="aiType('7')">7</button>
            <button class="ai-key" onclick="aiType('8')">8</button>
            <button class="ai-key" onclick="aiType('9')">9</button>
            <button class="ai-key" onclick="aiType('0')">0</button>
            <button class="ai-key action" onclick="aiDelete()"><i class="fas fa-delete-left"></i></button>
        </div>
        <div class="ai-input-row">
            <button class="ai-key" onclick="aiType('a')">A</button>
            <button class="ai-key" onclick="aiType('z')">Z</button>
            <button class="ai-key" onclick="aiType('e')">E</button>
            <button class="ai-key" onclick="aiType('r')">R</button>
            <button class="ai-key" onclick="aiType('t')">T</button>
            <button class="ai-key" onclick="aiType('y')">Y</button>
            <button class="ai-key" onclick="aiType('u')">U</button>
            <button class="ai-key" onclick="aiType('i')">I</button>
            <button class="ai-key" onclick="aiType('o')">O</button>
            <button class="ai-key" onclick="aiType('p')">P</button>
        </div>
        <div class="ai-input-row">
            <button class="ai-key" onclick="aiType('q')">Q</button>
            <button class="ai-key" onclick="aiType('s')">S</button>
            <button class="ai-key" onclick="aiType('d')">D</button>
            <button class="ai-key" onclick="aiType('f')">F</button>
            <button class="ai-key" onclick="aiType('g')">G</button>
            <button class="ai-key" onclick="aiType('h')">H</button>
            <button class="ai-key" onclick="aiType('j')">J</button>
            <button class="ai-key" onclick="aiType('k')">K</button>
            <button class="ai-key" onclick="aiType('l')">L</button>
            <button class="ai-key" onclick="aiType('m')">M</button>
        </div>
        <div class="ai-input-row">
            <button class="ai-key" onclick="aiType('w')">W</button>
            <button class="ai-key" onclick="aiType('x')">X</button>
            <button class="ai-key" onclick="aiType('c')">C</button>
            <button class="ai-key" onclick="aiType('v')">V</button>
            <button class="ai-key" onclick="aiType('b')">B</button>
            <button class="ai-key" onclick="aiType('n')">N</button>
            <button class="ai-key space" onclick="aiType(' ')"></button>
            <button class="ai-key accent" onclick="sendAIRequest()"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>
</div>

<script>
    // --- Configuration ---
    const GROQ_API_KEY = "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"; 
    const GROQ_API_URL = "https://api.groq.com/openai/v1/chat/completions";
    const MODEL_NAME = "llama-3.1-8b-instant"; 

    const CONFIG_USERS = {
        "metaservice": { pass: "Pass.123", avatar: "" },
        "meta actu": { pass: "Pass.123", avatar: "https://fv5-5.files.fm/thumb_show.php?i=gp3yrtpv2u&view&v=1" },
        "mazine2.0": { pass: "mazine.123", avatar: "https://fv5-5.files.fm/thumb_show.php?i=hdv4muhgpy&view&v=1" },
        "walid_hchm": { pass: "Pass.123", avatar: "" },
        "user": { pass: "12345", avatar: "" }
    };

    const LISTE_VIDEOS = [
        { id: "v0", auteur: "mazine2.0", vimeo_url: "https://player.cloudinary.com/embed/?cloud_name=di3uavh7l&public_id=9A7DD0EC-8A1F-4F23-ADE0-47D7AC52C80E_jix31x", legende: "Baston Abdelkabir vs El Gazzer", date: 800 },
        { id: "v1", auteur: "mazine2.0", vimeo_url: "https://player.cloudinary.com/embed/?cloud_name=di3uavh7l&public_id=WhatsApp_Video_2026-02-08_at_23.04.46_inqawp", legende: "üî•", date: 700 },
        { id: "v2", auteur: "mazine2.0", vimeo_url: "https://player.cloudinary.com/embed/?cloud_name=di3uavh7l&public_id=WhatsApp_Video_2026-02-09_at_23.40.08_zxllg0", legende: "ABO PRIME", date: 600 },
        { id: "v3", auteur: "mazine2.0", vimeo_url: "https://player.cloudinary.com/embed/?cloud_name=di3uavh7l&public_id=WhatsApp_Video_2026-02-08_at_22.24.50_vgmvka", legende: "EL GAZZER ave l'arbre", date: 500 }
    ];

    const LISTE_PHOTOS = [
        { id: "meta_actu_fixe", url: "https://fv5-5.files.fm/thumb_show.php?i=gp3yrtpv2u&view&v=1", auteur: "meta actu", date: 9999999 },
        { id: "p1", url: "https://fv5-5.files.fm/thumb_show.php?i=hdv4muhgpy&view&v=1", auteur: "mazine2.0", date: 550 },
        { id: "p2", url: "https://fv5-5.files.fm/thumb_show.php?i=rw3ztkktpt&view&v=1", auteur: "mazine2.0", date: 350 },
        { id: "p3", url: "https://fv5-5.files.fm/thumb_show.php?i=tbpxeusv7p&view&v=1", auteur: "user", date: 150 }
    ];

    let savedItems = JSON.parse(localStorage.getItem('metaSaved')) || [];
    let seenVideos = JSON.parse(localStorage.getItem('metaSeenVideos')) || [];
    let loggedUser = localStorage.getItem("metaUser") || "";
    let videoObserver = null;
    let currentObMode = 'dark';
    let deferredPrompt; 
    
    // --- Logique IA & Clavier ---
    let currentInput = "";
    
    function aiType(char) { currentInput += char; updateAIPreview(); }
    function aiDelete() { currentInput = currentInput.slice(0, -1); updateAIPreview(); }
    function updateAIPreview() {
        const preview = document.getElementById('ai-preview');
        if(currentInput.length === 0) preview.innerHTML = '<span class="ai-preview-placeholder">√âcrivez votre message...</span>';
        else preview.innerHTML = currentInput;
    }
    
    function toggleAIChat(state) {
        const win = document.getElementById('ai-chat-window');
        if(state) { win.classList.add('active'); currentInput = ""; updateAIPreview(); } 
        else { win.classList.remove('active'); }
    }

    function addAIMessage(text, sender) {
        const area = document.getElementById('ai-msg-area');
        const div = document.createElement('div');
        div.className = `ai-msg-bubble ${sender}`;
        div.innerText = text;
        area.appendChild(div);
        area.scrollTop = area.scrollHeight;
    }

    async function sendAIRequest() {
        const text = currentInput.trim();
        if (!text) return;
        addAIMessage(text, 'user');
        currentInput = "";
        updateAIPreview();
        addAIMessage("...", 'bot'); 

        try {
            const response = await fetch(GROQ_API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${GROQ_API_KEY}` },
                body: JSON.stringify({ model: MODEL_NAME, messages: [{role: "user", content: text}] })
            });
            const data = await response.json();
            const loadingMsg = document.querySelector('.ai-msg-bubble.bot:last-child');
            if(loadingMsg) loadingMsg.remove();
            if (data.choices && data.choices[0]) addAIMessage(data.choices[0].message.content, 'bot');
            else addAIMessage("Erreur de r√©ponse.", 'bot');
        } catch (e) {
            const loadingMsg = document.querySelector('.ai-msg-bubble.bot:last-child');
            if(loadingMsg) loadingMsg.remove();
            addAIMessage("Erreur de connexion.", 'bot');
        }
    }

    /* DETECTION INSTALLATION */
    function isRunningStandalone() { return (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true); }
    function isMobile() { return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent); }
    function isAndroid() { return /Android/i.test(navigator.userAgent); }

    function triggerAndroidInstall() {
        if (deferredPrompt) {
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then(choiceResult => {
                if (choiceResult.outcome === 'accepted') { console.log('User accepted'); }
                deferredPrompt = null;
                window.location.reload();
            });
        } else { window.location.reload(); }
    }
    window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); deferredPrompt = e; });

    /* LOGIQUE APP */
    function setViewportHeight() { let vh = window.innerHeight * 0.01; document.documentElement.style.setProperty('--vh', `${vh}px`); }
    window.addEventListener('resize', setViewportHeight);
    function applyTheme(mode, accent) {
        if (mode === 'light') document.body.classList.add('light-mode'); else document.body.classList.remove('light-mode');
        document.body.setAttribute('data-accent', accent);
        localStorage.setItem('metaThemeMode', mode); localStorage.setItem('metaThemeAccent', accent);
    }
    function setObMode(mode) {
        currentObMode = mode;
        document.getElementById('ob-step-1').classList.remove('active'); document.getElementById('ob-step-2').classList.add('active');
        const container = document.getElementById('ob-color-container'); container.innerHTML = '';
        let colors = [];
        if (mode === 'dark') colors = [{ id: 'gold', name: 'Or', class: 'cc-gold' }, { id: 'blue', name: 'Bleu', class: 'cc-blue' }, { id: 'white', name: 'Blanc', class: 'cc-white' }];
        else colors = [{ id: 'black', name: 'Noir', class: 'cc-black' }, { id: 'blue', name: 'Bleu', class: 'cc-blue' }, { id: 'grey', name: 'Gris', class: 'cc-grey' }];
        colors.forEach(c => { container.innerHTML += `<div class="color-circle ${c.class}" onclick="selectObColor('${c.id}', this)">${c.name}</div>`; });
    }
    let selectedObColor = null;
    function selectObColor(color, elem) { document.querySelectorAll('#ob-color-container .color-circle').forEach(e => e.classList.remove('active')); elem.classList.add('active'); selectedObColor = color; document.getElementById('ob-validate-btn').disabled = false; }
    function validateOnboarding() { if (!selectedObColor) return; applyTheme(currentObMode, selectedObColor); document.getElementById('onboarding-screen').style.display = 'none'; document.getElementById('login-screen').style.display = 'flex'; }
    function getAvatar(username) { const user = CONFIG_USERS[username]; if (user && user.avatar) return `<img src="${user.avatar}" alt="${username}">`; return `<i class="fas fa-user" aria-hidden="true"></i>`; }
    function handleLogin() {
        const u = document.getElementById("username").value.trim().toLowerCase(); const p = document.getElementById("password").value;
        if (CONFIG_USERS[u] && CONFIG_USERS[u].pass === p) {
            if (document.getElementById("remember-me").checked) localStorage.setItem("metaUser", u); else localStorage.removeItem("metaUser");
            loggedUser = u; startApp();
        } else { document.getElementById("login-error").style.display = "block"; }
    }
    function startApp() {
        document.getElementById("login-screen").style.display = "none"; document.getElementById("main-app").style.display = "flex"; document.querySelector("header").style.display = "flex";
        document.getElementById('ai-btn-header').style.display = 'flex';
        document.getElementById("my-name-display").innerText = loggedUser; document.getElementById("my-handle-display").innerText = "@" + loggedUser.replace(/\s+/g, '_'); document.getElementById("my-profile-pic-container").innerHTML = getAvatar(loggedUser);
        renderStories(); genererContenu(); renderMyProfile(); switchTab('feed', 0); updateSettingsUI();
    }
    function renderStories() { const storiesList = document.getElementById('stories-list'); storiesList.innerHTML = ""; Object.keys(CONFIG_USERS).forEach(username => { storiesList.insertAdjacentHTML('beforeend', `<button class="story-bubble btn-press" onclick="openExternalProfile('${username}')"><div class="story-img-wrapper">${getAvatar(username)}</div><div class="story-name">${username}</div></button>`); }); }
    function switchTab(t, i) {
        document.getElementById('settings-overlay').style.display = 'none'; document.getElementById('external-profile-overlay').style.display = 'none'; document.getElementById('media-view-overlay').style.display = 'none';
        document.body.classList.remove('has-overlay');
        if (t === 'settings') { document.getElementById('settings-overlay').style.display = 'block'; updateSettingsUI(); document.body.classList.add('has-overlay'); return; }
        if (t === 'external-profile') { document.getElementById('external-profile-overlay').style.display = 'block'; document.body.classList.add('has-overlay'); return; }
        if (t === 'media-view') { document.getElementById('media-view-overlay').style.display = 'block'; document.body.classList.add('has-overlay'); return; }
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active')); document.getElementById(t + '-section').classList.add('active');
        document.querySelectorAll('nav button').forEach((btn, idx) => btn.classList.toggle('active', idx === i));
        document.getElementById('main-header').style.display = (t === 'videos') ? "none" : "flex";
        document.getElementById('global-cog').style.display = (t === 'own-profile') ? "block" : "none";
        const aiBtn = document.getElementById('ai-btn-header'); if(aiBtn) aiBtn.style.display = (t === 'feed') ? 'flex' : 'none';
        moveIndicator(i);
        if (t !== 'videos') stopAllVideos(); else setTimeout(observeVideos, 100);
    }
    function moveIndicator(i) { const buttons = document.querySelectorAll('nav button.nav-item'); const indicator = document.getElementById('nav-indicator'); if(buttons[i]) { const rect = buttons[i].getBoundingClientRect(); const navRect = buttons[i].parentElement.getBoundingClientRect(); indicator.style.left = (rect.left - navRect.left + rect.width/2 - 15) + 'px'; } }
    function stopAllVideos() { document.querySelectorAll('.video-card iframe').forEach(iframe => { iframe.src = ""; }); }
    function observeVideos() {
        if (videoObserver) videoObserver.disconnect(); const cards = document.querySelectorAll('.video-card');
        videoObserver = new IntersectionObserver((entries) => { entries.forEach(entry => { const iframe = entry.target.querySelector('iframe'); if (!iframe) return; const targetSrc = iframe.getAttribute('data-src'); const videoId = entry.target.getAttribute('data-id'); if (entry.isIntersecting) { if(iframe.src === "" || iframe.src !== targetSrc) iframe.src = targetSrc; setTimeout(() => { iframe.contentWindow.postMessage('{"method":"play"}', '*'); }, 200); if(videoId && !seenVideos.includes(videoId)) { seenVideos.push(videoId); localStorage.setItem('metaSeenVideos', JSON.stringify(seenVideos)); const badge = entry.target.querySelector('.seen-badge'); if(badge) badge.style.display = 'none'; } } else { iframe.contentWindow.postMessage('{"method":"pause"}', '*'); iframe.src = ""; } }); }, { threshold: 0.6 }); cards.forEach(card => videoObserver.observe(card));
    }
    function openExternalProfile(username) { if(username === loggedUser) { switchTab('own-profile', 3); return; } const overlay = document.getElementById('external-profile-overlay'); document.getElementById('ext-user-title').innerText = username; document.getElementById('ext-display-name').innerText = username; document.getElementById('ext-profile-pic-container').innerHTML = getAvatar(username); const grid = document.getElementById('ext-posts-grid'); grid.innerHTML = ""; const allMedia = [...LISTE_PHOTOS.filter(p => p.auteur === username).map(p => ({...p, type:'photo'})), ...LISTE_VIDEOS.filter(v => v.auteur === username).map(v => ({...v, type:'video'}))].sort((a,b) => b.date - a.date); if (allMedia.length === 0) grid.innerHTML = `<div class="empty-state">Aucune publication</div>`; else allMedia.forEach(m => { grid.insertAdjacentHTML('beforeend', `<button class="grid-item" onclick="switchTab('media-view'); openMediaView('${m.id}', '${m.type}')">${m.type==='photo'?`<img src="${m.url}">`:`<div style="height:100%;display:flex;align-items:center;justify-content:center;background:#000;color:white;"><i class="fas fa-play"></i></div>`}</button>`); }); overlay.style.display = 'block'; document.body.classList.add('has-overlay'); }
    function closeExternalProfile() { document.getElementById('external-profile-overlay').style.display = 'none'; document.body.classList.remove('has-overlay'); }
    function renderMyProfile() { const gridPosts = document.getElementById('my-posts-grid'); const gridSaved = document.getElementById('my-saved-grid'); gridPosts.innerHTML = ""; gridSaved.innerHTML = ""; const myPosts = LISTE_PHOTOS.filter(p => p.auteur === loggedUser); document.getElementById('stat-posts').innerText = myPosts.length; document.getElementById('stat-saved').innerText = savedItems.length; if (myPosts.length === 0) gridPosts.innerHTML = `<div class="empty-state">Aucune publication</div>`; else myPosts.forEach(p => { gridPosts.insertAdjacentHTML('beforeend', `<button class="grid-item" onclick="switchTab('media-view'); openMediaView('${p.id}', 'photo')"><img src="${p.url}"></button>`); }); if (savedItems.length === 0) gridSaved.innerHTML = `<div class="empty-state">Aucun √©l√©ment enregistr√©</div>`; else LISTE_PHOTOS.forEach(p => { if(savedItems.includes(p.id)) { gridSaved.insertAdjacentHTML('beforeend', `<button class="grid-item" onclick="switchTab('media-view'); openMediaView('${p.id}', 'photo')"><img src="${p.url}"></button>`); }}); }
    function switchMyTab(t) { document.getElementById('my-tab-pub').classList.toggle('active', t === 'info'); document.getElementById('my-tab-saved').classList.toggle('active', t === 'saved'); document.getElementById('my-posts-grid').style.display = t === 'info' ? 'grid' : 'none'; document.getElementById('my-saved-grid').style.display = t === 'saved' ? 'grid' : 'none'; }
    function genererContenu() { const photoDiv = document.getElementById('photo-list'); const videoDiv = document.getElementById('video-list'); photoDiv.innerHTML = ""; videoDiv.innerHTML = ""; const postMeta = LISTE_PHOTOS.find(p => p.id === "meta_actu_fixe"); const autresPhotos = LISTE_PHOTOS.filter(p => p.id !== "meta_actu_fixe").sort((a, b) => b.date - a.date); const fluxFinal = postMeta ? [postMeta, ...autresPhotos] : autresPhotos; fluxFinal.forEach(p => { const isSaved = savedItems.includes(p.id); photoDiv.insertAdjacentHTML('beforeend', `<article class="post"><div class="post-user" onclick="openExternalProfile('${p.auteur}')"><div class="mini-avatar">${getAvatar(p.auteur)}</div> ${p.auteur}</div><div class="post-img-container" ondblclick="animateLike(this)"><img src="${p.url}"><div class="like-overlay"><i class="fas fa-heart" style="font-size: 5rem;"></i></div></div><div class="post-actions"><button class="action-btn btn-press ${isSaved ? 'saved' : ''}" onclick="toggleSave('${p.id}', this)"><i class="${isSaved ? 'fas' : 'far'} fa-bookmark"></i></button></div></article>`); }); const unseen = LISTE_VIDEOS.filter(v => !seenVideos.includes(v.id)).sort((a, b) => b.date - a.date); const seen = LISTE_VIDEOS.filter(v => seenVideos.includes(v.id)).sort((a, b) => b.date - a.date); const sortedVideos = [...unseen, ...seen]; sortedVideos.forEach(v => { const hasBeenSeen = seenVideos.includes(v.id); videoDiv.insertAdjacentHTML('beforeend', `<div class="video-card" data-id="${v.id}"><iframe data-src="${v.vimeo_url}&autoplay=1" src="" frameborder="0" allow="autoplay; fullscreen"></iframe><div class="video-info"><h3>@${v.auteur}</h3><p>${v.legende}</p></div>${hasBeenSeen ? '<div class="seen-badge">Vu</div>' : ''}</div>`); }); setTimeout(observeVideos, 500); }
    function animateLike(container) { const overlay = container.querySelector('.like-overlay'); overlay.classList.remove('animate'); void overlay.offsetWidth; overlay.classList.add('animate'); }
    function openMediaView(id, type) { const overlay = document.getElementById('media-view-overlay'); const content = document.getElementById('media-view-content'); let item = (type === 'photo') ? LISTE_PHOTOS.find(p => p.id === id) : LISTE_VIDEOS.find(v => v.id === id); if(item) { content.innerHTML = `<article class="post"><div class="post-user" onclick="openExternalProfile('${item.auteur}')"><div class="mini-avatar">${getAvatar(item.auteur)}</div> ${item.auteur}</div>${type==='photo'?`<img src="${item.url}" style="width:100%">`:`<iframe src="${item.vimeo_url}&autoplay=1" style="width:100%;height:450px;" allow="autoplay; fullscreen"></iframe>`}<div class="post-actions"><button class="action-btn btn-press ${savedItems.includes(item.id)?'saved':''}" onclick="toggleSave('${item.id}', this)"><i class="${savedItems.includes(item.id)?'fas':'far'} fa-bookmark"></i></button></div></article>`; overlay.style.display = 'block'; document.body.classList.add('has-overlay'); } }
    function closeMediaView() { document.getElementById('media-view-overlay').style.display = 'none'; document.querySelectorAll('#media-view-content iframe').forEach(f => f.src = ""); document.body.classList.remove('has-overlay'); }
    function toggleSettings(s) { if(s) { document.getElementById('settings-overlay').style.display = 'block'; document.body.classList.add('has-overlay'); } else { document.getElementById('settings-overlay').style.display = 'none'; document.body.classList.remove('has-overlay'); } updateSettingsUI(); }
    function filtrerRecherche() { const q = document.getElementById('search-input').value.toLowerCase(); const res = document.getElementById('search-results'); res.innerHTML = ""; if(q.length < 1) return; Object.keys(CONFIG_USERS).forEach(u => { if(u.includes(q)) { res.insertAdjacentHTML('beforeend', `<button style="padding:25px; cursor:pointer; background:transparent; border-bottom:1px solid var(--border); display:flex; align-items:center; gap:20px; width:100%; text-align:left;" onclick="openExternalProfile('${u}')"><div class="mini-avatar" style="width:45px; height:45px; border-radius:50%; overflow:hidden; background:#222; display:flex; align-items:center; justify-content:center;">${getAvatar(u)}</div> <b style="color: var(--text-main); text-transform: uppercase; letter-spacing: 2px; font-weight: 500; font-size: 0.9rem;">${u}</b></button>`); } }); }
    function toggleSave(id, btn) { const icon = btn.querySelector('i'); if (savedItems.includes(id)) { savedItems = savedItems.filter(i => i !== id); icon.classList.replace('fas', 'far'); btn.classList.remove('saved'); } else { savedItems.push(id); icon.classList.replace('far', 'fas'); btn.classList.add('saved'); } localStorage.setItem('metaSaved', JSON.stringify(savedItems)); renderMyProfile(); }
    function setThemeMode(mode) { let currentAccent = localStorage.getItem('metaThemeAccent') || 'gold'; if(mode === 'light' && (currentAccent === 'white' || currentAccent === 'gold')) currentAccent = 'black'; if(mode === 'dark' && currentAccent === 'black') currentAccent = 'gold'; applyTheme(mode, currentAccent); updateSettingsUI(); }
    function setThemeAccent(accent) { const mode = localStorage.getItem('metaThemeMode') || 'dark'; applyTheme(mode, accent); updateSettingsUI(); }
    function updateSettingsUI() { const mode = localStorage.getItem('metaThemeMode') || 'dark'; const accent = localStorage.getItem('metaThemeAccent') || 'gold'; document.getElementById('btn-mode-dark').classList.toggle('selected', mode === 'dark'); document.getElementById('btn-mode-light').classList.toggle('selected', mode === 'light'); const picker = document.getElementById('settings-color-picker'); picker.innerHTML = ''; let colors = (mode === 'dark') ? [{id:'gold', class:'cc-gold'}, {id:'blue', class:'cc-blue'}, {id:'white', class:'cc-white'}] : [{id:'black', class:'cc-black'}, {id:'blue', class:'cc-blue'}, {id:'grey', class:'cc-grey'}]; colors.forEach(c => { const isActive = (c.id === accent); picker.innerHTML += `<div class="picker-circle ${c.class} ${isActive ? 'active' : ''}" onclick="setThemeAccent('${c.id}')"></div>`; }); }
    function handleLogout() { localStorage.removeItem("metaUser"); location.reload(); }

    window.addEventListener('load', () => {
        setViewportHeight();
        
        setTimeout(() => {
            document.getElementById('loader').style.display = 'none';
            
            // --- LOGIQUE DE D√âMARRAGE CORRIG√âE ---
            const standalone = isRunningStandalone();
            const android = isAndroid();

            if (standalone) {
                // 1. Si d√©j√† install√© -> Acc√®s normal (PC, Android install√©, iOS install√©)
                const hasPrefs = localStorage.getItem('metaThemeMode');
                if (!hasPrefs) document.getElementById('onboarding-screen').style.display = 'flex';
                else { applyTheme(hasPrefs, localStorage.getItem('metaThemeAccent')); if(loggedUser) startApp(); else document.getElementById('login-screen').style.display = 'flex'; }
            } else if (android) {
                // 2. Si Android ET non install√© -> Forcer installation
                document.getElementById('loader').style.display = 'flex';
                document.getElementById('default-loader-ui').style.display = 'none';
                document.getElementById('android-install-ui').style.display = 'flex';
            } else if (isMobile()) {
                // 3. Si iOS (ou autre mobile) non install√© -> Instructions iOS
                document.getElementById('loader').style.display = 'flex';
                document.getElementById('default-loader-ui').style.display = 'flex';
                document.getElementById('android-install-ui').style.display = 'none';
                document.getElementById('install-block-content').style.display = 'flex';
                document.querySelector('.loader-icon').style.display = 'block';
                document.getElementById('main-loader-text').innerText = "Meta Officiel";
            } else {
                // 4. Si PC (Desktop) -> Acc√®s direct m√™me si non "install√©"
                const hasPrefs = localStorage.getItem('metaThemeMode');
                if (!hasPrefs) document.getElementById('onboarding-screen').style.display = 'flex';
                else { applyTheme(hasPrefs, localStorage.getItem('metaThemeAccent')); if(loggedUser) startApp(); else document.getElementById('login-screen').style.display = 'flex'; }
            }
        }, 1500);
    });
</script>
</body>
</html>
